---
- name: Configuring target server
  hosts: ubuntu1
  become: yes

  vars:
    source_dir : ../../webserver/
    destin_dir : /home/ubuntu/webserver

  tasks:

  - name: Wait 600 seconds for target server to become reachable
    wait_for_connection:

  - name: Copy source files to target server
    copy: src={{ source_dir }} dest={{ destin_dir }} mode=0755
    
  - name: Build Docker image from Dockerfile
    docker_image:
      path: /home/ubuntu/webserver/infrastructure/docker/
      name: webserver
      source: pull
      state: present
      
  - name: Run Docker container
    docker_container:
      name: webserver
      image: webserver
      state: started
      ports:
      - "8888:80"
      detach: true
